# Pap√©is e Permiss√µes - Sistema Koerner 360

## üìã Vis√£o Geral

O Sistema Koerner 360 √© uma plataforma de gest√£o de feedback e avalia√ß√µes que opera com duas entidades principais distintas: **Usu√°rios** e **Atendentes**. Cada entidade possui fun√ß√µes, responsabilidades e fluxos de trabalho independentes, embora interajam no contexto das avalia√ß√µes.

### Conceito Fundamental

**Usu√°rios** e **Atendentes** s√£o entidades completamente separadas no sistema:

- **Atendentes**: S√£o registrados no sistema para serem **avaliados** em pesquisas de satisfa√ß√£o
- **Usu√°rios**: T√™m acesso ao sistema para **consultar** os dados das avalia√ß√µes realizadas

## üé≠ Defini√ß√£o de Entidades

### üë§ Atendente

**Prop√≥sito**: Profissionais que prestam atendimento e s√£o objeto de avalia√ß√£o.

**Caracter√≠sticas**:
- Cadastrados no sistema para serem avaliados
- N√£o possuem acesso direto ao sistema
- S√£o o foco das pesquisas de satisfa√ß√£o
- T√™m dados pessoais e profissionais registrados
- Podem ter m√∫ltiplas avalia√ß√µes associadas

**Dados Armazenados**:
- Informa√ß√µes pessoais (nome, email, telefone)
- Dados profissionais (cargo, departamento, supervisor)
- Endere√ßo e observa√ß√µes
- Status (ativo/inativo)
- Hist√≥rico de avalia√ß√µes recebidas

### üë• Usu√°rio

**Prop√≥sito**: Pessoas autorizadas a acessar o sistema para consultar e gerenciar dados de avalia√ß√µes.

**Caracter√≠sticas**:
- Possuem credenciais de acesso ao sistema
- Podem consultar dados de avalia√ß√µes
- T√™m diferentes n√≠veis de permiss√£o
- Gerenciam o sistema e seus dados
- N√£o s√£o objeto de avalia√ß√£o

**Dados Armazenados**:
- Credenciais de acesso (email, senha)
- Informa√ß√µes b√°sicas (nome, tipo)
- Permiss√µes e n√≠vel de acesso
- Logs de atividade no sistema

## üîê Tipos de Usu√°rio e Permiss√µes

### 1. Usu√°rio Administrador

**Responsabilidades**:
- Gest√£o completa do sistema
- Cria√ß√£o e gerenciamento de outros usu√°rios
- Configura√ß√£o de par√¢metros do sistema
- Acesso a todos os dados e relat√≥rios
- Gest√£o de atendentes

**Permiss√µes**:
- ‚úÖ Criar, editar e excluir usu√°rios
- ‚úÖ Criar, editar e excluir atendentes
- ‚úÖ Visualizar todas as avalia√ß√µes
- ‚úÖ Gerar relat√≥rios completos
- ‚úÖ Configurar sistema
- ‚úÖ Gerenciar permiss√µes
- ‚úÖ Acesso ao painel administrativo

### 2. Usu√°rio Supervisor

**Responsabilidades**:
- Supervis√£o de atendentes espec√≠ficos
- An√°lise de avalia√ß√µes de sua equipe
- Gera√ß√£o de relat√≥rios departamentais
- Gest√£o limitada de atendentes

**Permiss√µes**:
- ‚úÖ Visualizar atendentes de sua supervis√£o
- ‚úÖ Editar dados de atendentes supervisionados
- ‚úÖ Visualizar avalia√ß√µes de sua equipe
- ‚úÖ Gerar relat√≥rios departamentais
- ‚ùå Criar/excluir usu√°rios
- ‚ùå Configurar sistema
- ‚ùå Acesso a dados de outras equipes

### 3. Usu√°rio Consultor

**Caracter√≠sticas:**
- Acesso somente leitura ao sistema com foco em gamifica√ß√£o
- Especialista em an√°lise competitiva entre atendentes
- Respons√°vel por promover competitividade saud√°vel
- Acesso a dashboards de ranking e compara√ß√£o
- Foco em m√©tricas de gamifica√ß√£o e performance

**Responsabilidades:**
- Consultar avalia√ß√µes com foco em compara√ß√£o entre atendentes
- Gerar relat√≥rios de ranking e performance competitiva
- Analisar m√©tricas de gamifica√ß√£o (pontos, n√≠veis, conquistas)
- Acompanhar evolu√ß√£o temporal de atendentes
- Promover competitividade atrav√©s de insights
- Identificar oportunidades de melhoria baseadas em compara√ß√µes

**Permiss√µes Espec√≠ficas:**
- ‚úÖ Visualizar rankings de atendentes por diferentes m√©tricas
- ‚úÖ Acessar sistema de gamifica√ß√£o (pontos, n√≠veis, conquistas)
- ‚úÖ Gerar relat√≥rios comparativos entre atendentes
- ‚úÖ Visualizar dashboards de competitividade
- ‚úÖ Exportar dados de performance e rankings
- ‚úÖ Acessar m√©tricas avan√ßadas de compara√ß√£o
- ‚úÖ Visualizar evolu√ß√£o temporal de performance
- ‚ùå Criar/editar/excluir qualquer registro
- ‚ùå Gerenciar usu√°rios ou atendentes
- ‚ùå Modificar sistema de pontua√ß√£o ou conquistas
- ‚ùå Configurar par√¢metros de gamifica√ß√£o

## üéÆ Sistema de Gamifica√ß√£o

### Vis√£o Geral
O Sistema Koerner 360 implementa um robusto sistema de gamifica√ß√£o focado em promover competitividade saud√°vel entre atendentes e fornecer insights valiosos para usu√°rios consultores.

### Componentes do Sistema

#### 1. Sistema de Pontua√ß√£o
- **Pontos por Avalia√ß√£o**: Baseado na nota recebida (1-5)
- **B√¥nus de Sequ√™ncia**: Pontos extras por consist√™ncia
- **Multiplicadores**: Fatores baseados em per√≠odo e contexto
- **Penaliza√ß√µes**: Redu√ß√£o por performance baixa

#### 2. N√≠veis e Progress√£o
- **7 N√≠veis**: Iniciante ‚Üí Lenda
- **Experi√™ncia Acumulativa**: Baseada em pontos totais
- **T√≠tulos Especiais**: Reconhecimento por conquistas
- **Benef√≠cios por N√≠vel**: Vantagens progressivas

#### 3. Sistema de Conquistas
- **5 Categorias**: Bronze, Prata, Ouro, Platina, Diamante
- **Tipos de Conquista**: Volume, Qualidade, Consist√™ncia, Especiais
- **Requisitos Din√¢micos**: Crit√©rios adaptativos
- **Recompensas**: Pontos e reconhecimento

#### 4. Rankings e Competi√ß√£o
- **Rankings Globais**: Posi√ß√£o entre todos os atendentes
- **Rankings Setoriais**: Competi√ß√£o por departamento
- **Rankings Temporais**: Mensal, trimestral, anual
- **M√©tricas M√∫ltiplas**: Diferentes crit√©rios de ordena√ß√£o

### Permiss√µes por Papel

#### Usu√°rio Consultor (Foco Principal)
- ‚úÖ **Visualiza√ß√£o Completa**: Acesso a todos os rankings e m√©tricas
- ‚úÖ **An√°lise Comparativa**: Ferramentas de compara√ß√£o entre atendentes
- ‚úÖ **Relat√≥rios Especializados**: Relat√≥rios focados em competitividade
- ‚úÖ **Dashboards Interativos**: Visualiza√ß√µes din√¢micas de performance
- ‚úÖ **Exporta√ß√£o de Dados**: Dados para an√°lises externas
- ‚ùå **Modifica√ß√£o**: N√£o pode alterar pontua√ß√µes ou conquistas

#### Administrador
- ‚úÖ **Configura√ß√£o Completa**: Definir regras de pontua√ß√£o
- ‚úÖ **Gest√£o de Conquistas**: Criar/editar/remover conquistas
- ‚úÖ **Ajustes de Sistema**: Modificar algoritmos e par√¢metros
- ‚úÖ **Relat√≥rios Administrativos**: M√©tricas de engajamento
- ‚úÖ **Auditoria**: Logs de atividades do sistema

#### Supervisor
- ‚úÖ **Visualiza√ß√£o Setorial**: Rankings e m√©tricas do seu setor
- ‚úÖ **Relat√≥rios Departamentais**: Performance da sua equipe
- ‚úÖ **Acompanhamento**: Evolu√ß√£o dos atendentes supervisionados
- ‚ùå **Configura√ß√£o**: N√£o pode alterar regras globais

### M√©tricas de Gamifica√ß√£o

#### M√©tricas Individuais
- **Pontua√ß√£o Total**: Soma acumulada de pontos
- **N√≠vel Atual**: Baseado na experi√™ncia
- **Posi√ß√£o no Ranking**: Posi√ß√£o relativa
- **Conquistas Obtidas**: Badges e reconhecimentos
- **Sequ√™ncia Atual**: Dias consecutivos de boa performance
- **Taxa de Crescimento**: Evolu√ß√£o da pontua√ß√£o

#### M√©tricas Comparativas
- **Gap de Performance**: Diferen√ßa para l√≠deres
- **Percentil**: Posi√ß√£o percentual
- **Tend√™ncia**: Dire√ß√£o da evolu√ß√£o
- **Consist√™ncia**: Variabilidade da performance
- **Velocidade de Progress√£o**: Taxa de subida de n√≠vel

#### M√©tricas de Equipe
- **Ranking Setorial**: Posi√ß√µes por departamento
- **M√©dia do Setor**: Compara√ß√£o com pares
- **Distribui√ß√£o de N√≠veis**: Composi√ß√£o da equipe
- **Conquistas Coletivas**: Achievements de grupo

## üîÑ Fluxos de Trabalho

### Fluxo de Cadastro de Atendente

1. **Usu√°rio Administrador/Supervisor** acessa o sistema
2. Navega para "Gest√£o de Atendentes"
3. Cadastra novo atendente com dados pessoais e profissionais
4. Atendente fica dispon√≠vel para receber avalia√ß√µes
5. Sistema gera identificador √∫nico para o atendente

### Fluxo de Avalia√ß√£o

#### Sistema Atual de Pesquisa de Satisfa√ß√£o

**URL de Acesso**: `https://www.e-koerner.com.br/survey?attendantId={id}`

**Exemplo**: `https://www.e-koerner.com.br/survey?attendantId=4c16287b-8e11-4646-8e9a-bb3ea41c608f`

**Caracter√≠sticas do Sistema Atual**:
- ‚úÖ **Acesso P√∫blico**: N√£o requer autentica√ß√£o
- ‚úÖ **Identifica√ß√£o por UUID**: Cada atendente possui ID √∫nico
- ‚úÖ **Interface Responsiva**: Compat√≠vel com dispositivos m√≥veis
- ‚ö†Ô∏è **Tempo de Carregamento**: Alguns segundos para carregamento completo
- ‚úÖ **Coment√°rios Opcionais**: Campo para feedback adicional
- ‚úÖ **Foco na Melhoria**: "Seu feedback nos ajuda a melhorar nossos servi√ßos"

#### Fluxo Detalhado

1. **Cliente/Avaliador** acessa URL espec√≠fica do atendente
2. **Sistema** carrega formul√°rio de pesquisa (aguardar carregamento completo)
3. **Avaliador** preenche question√°rio de satisfa√ß√£o
4. **Avaliador** pode deixar coment√°rio opcional
5. **Sistema** registra avalia√ß√£o com timestamp
6. **Usu√°rios autenticados** podem consultar a avalia√ß√£o no dashboard

### Fluxo de Consulta de Dados

1. **Usu√°rio** faz login no sistema
2. Acessa dashboard com m√©tricas gerais
3. Navega para se√ß√µes espec√≠ficas conforme permiss√µes
4. Consulta avalia√ß√µes, relat√≥rios e dados de atendentes
5. Gera relat√≥rios conforme necess√°rio

## üèóÔ∏è Estrutura do Banco de Dados

### Migra√ß√£o de Dados do Supabase

**Contexto da Migra√ß√£o**: O sistema Koerner 360 passou por uma migra√ß√£o completa de dados do Supabase para PostgreSQL local, garantindo a preserva√ß√£o total dos dados hist√≥ricos e a continuidade operacional. A migra√ß√£o incluiu **37 usu√°rios** e **56 avalia√ß√µes** com dados completos de perfil profissional.

#### Estrutura das Tabelas no Supabase

**Tabela `users` (Origem)**:
```sql
-- Estrutura completa da tabela users no Supabase
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR NOT NULL,
  email VARCHAR UNIQUE NOT NULL,
  password VARCHAR NOT NULL,
  role VARCHAR NOT NULL,
  accessType VARCHAR NOT NULL,
  status VARCHAR DEFAULT 'ativo',
  avatarUrl TEXT,
  telefone VARCHAR,
  portaria VARCHAR,
  situacao VARCHAR,
  dataAdmissao DATE,
  dataNascimento DATE,
  rg VARCHAR,
  cpf VARCHAR UNIQUE,
  createdAt TIMESTAMPTZ DEFAULT now(),
  updatedAt TIMESTAMPTZ DEFAULT now()
);
```

**Tabela `reviews` (Origem)**:
```sql
-- Estrutura da tabela reviews no Supabase
CREATE TABLE reviews (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  attendantId UUID NOT NULL REFERENCES users(id),
  rating INTEGER NOT NULL,
  comment TEXT,
  date TIMESTAMPTZ DEFAULT now()
);
```

#### Mapeamento de Dados

**Tipos de Usu√°rios Identificados**:
- **Admin**: 5 usu√°rios (admin, Assistente administrativo, Tabeli√£o Substituto)
- **Attendant**: 32 usu√°rios (diversos cargos de cart√≥rio)

**Cargos Profissionais Mapeados**:
- Escrevente (5), Escrevente I (6), Escrevente II (3)
- Escrevente Agile (1), Escrevente Agile I (1)
- Auxiliar de cart√≥rio (3)
- Tabeli√£o Substituto (3)
- Assistente administrativo (2)
- attendant (12) - cargo gen√©rico
- admin (1) - administrador sistema

**Tabelas Migradas**:
- **users** ‚Üí **usuarios**: 37 usu√°rios com dados completos de perfil
- **reviews** ‚Üí **avaliacoes**: 56 avalia√ß√µes hist√≥ricas com preserva√ß√£o de relacionamentos

**Processo de Migra√ß√£o**:
1. An√°lise estrutural das tabelas Supabase
2. Mapeamento de campos e tipos de dados
3. Cria√ß√£o de scripts de migra√ß√£o sem perda de dados
4. Valida√ß√£o de integridade referencial
5. Importa√ß√£o completa com verifica√ß√£o de consist√™ncia

### Tabela: usuarios
```sql
CREATE TABLE usuarios (
  id VARCHAR PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  senha_hash VARCHAR(255) NOT NULL,
  tipo ENUM('admin', 'supervisor', 'consultor') NOT NULL,
  ativo BOOLEAN DEFAULT true,
  -- Campos migrados do Supabase
  telefone VARCHAR(20),
  portaria VARCHAR(100),
  situacao VARCHAR(50),
  data_admissao DATE,
  data_nascimento DATE,
  rg VARCHAR(20),
  cpf VARCHAR(14),
  avatar_url TEXT,
  access_type VARCHAR(50),
  -- Campos de controle
  criado_em TIMESTAMP DEFAULT NOW(),
  atualizado_em TIMESTAMP DEFAULT NOW(),
  migrado_supabase BOOLEAN DEFAULT false,
  supabase_id VARCHAR -- Refer√™ncia ao ID original do Supabase
);
```

### Tabela: atendentes
```sql
CREATE TABLE atendentes (
  id VARCHAR PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  email VARCHAR(255),
  telefone VARCHAR(20),
  cargo VARCHAR(100),
  departamento VARCHAR(100),
  supervisor_id VARCHAR REFERENCES usuarios(id),
  endereco TEXT,
  observacoes TEXT,
  status ENUM('ativo', 'inativo', 'licenca') DEFAULT 'ativo',
  criado_em TIMESTAMP DEFAULT NOW(),
  atualizado_em TIMESTAMP DEFAULT NOW()
);
```

### Tabela: avaliacoes
```sql
CREATE TABLE avaliacoes (
  id VARCHAR PRIMARY KEY,
  atendente_id VARCHAR REFERENCES atendentes(id),
  avaliador_nome VARCHAR(100),
  avaliador_email VARCHAR(255),
  nota_geral INTEGER CHECK (nota_geral >= 1 AND nota_geral <= 5),
  comentarios TEXT,
  data_avaliacao TIMESTAMP DEFAULT NOW(),
  ip_origem INET,
  user_agent TEXT,
  -- Campos de migra√ß√£o do Supabase
  migrado_supabase BOOLEAN DEFAULT false,
  supabase_id VARCHAR, -- Refer√™ncia ao ID original do Supabase
  supabase_attendant_id VARCHAR -- ID do atendente no Supabase
);
```

### Tabela: dados_migracao_supabase
```sql
CREATE TABLE dados_migracao_supabase (
  id VARCHAR PRIMARY KEY,
  tabela_origem VARCHAR(50) NOT NULL,
  tabela_destino VARCHAR(50) NOT NULL,
  total_registros INTEGER NOT NULL,
  registros_migrados INTEGER NOT NULL,
  registros_com_erro INTEGER DEFAULT 0,
  data_inicio_migracao TIMESTAMP NOT NULL,
  data_fim_migracao TIMESTAMP,
  status VARCHAR(20) DEFAULT 'em_andamento',
  observacoes TEXT,
  checksum_origem VARCHAR(255),
  checksum_destino VARCHAR(255)
);
```

### Sistema de Gamifica√ß√£o Migrado

O Supabase continha configura√ß√µes avan√ßadas de gamifica√ß√£o que foram preservadas:

#### Configura√ß√µes de Gamifica√ß√£o
```json
{
  "gamification": {
    "enabled": true,
    "levelSystem": {
      "enabled": true,
      "thresholds": [0, 100, 250, 500, 1000, 2000, 3500, 5000, 7500, 10000]
    },
    "streakSystem": {
      "enabled": true,
      "maxDays": 30
    },
    "currentPeriod": {
      "name": "Per√≠odo 2025 - 1¬∫ Semestre",
      "startDate": "2025-01-01",
      "endDate": "2025-06-30",
      "description": "Per√≠odo de gamifica√ß√£o do primeiro semestre de 2025"
    }
  }
}
```

#### Conquistas (Achievement Badges)
- **Primeira Avalia√ß√£o** (Bronze): 1 avalia√ß√£o
- **Dedicado** (Prata): 10 avalia√ß√µes
- **Comprometido** (Ouro): 50 avalia√ß√µes
- **Excepcional** (Platina): 100 avalia√ß√µes
- **Perfei√ß√£o** (Platina): Nota 5.0 com 10+ avalia√ß√µes
- **Excel√™ncia** (Ouro): M√©dia 4.5+ com 5+ avalia√ß√µes
- **Consistente** (Prata): 7 dias consecutivos
- **Satisfa√ß√£o Garantida** (Ouro): 90% avalia√ß√µes positivas

#### Badges de Tempo de Servi√ßo
- **Iniciante** (1-2 anos): Azul
- **Dedicado** (3-4 anos): Verde
- **Veterano** (5-6 anos): Roxo
- **Especialista** (7-8 anos): Amarelo
- **Mestre** (9+ anos): Laranja

### Campos Adicionais Migrados

#### Tabela `usuarios`
- `telefone`: Telefone do usu√°rio
- `portaria`: N√∫mero da portaria de lota√ß√£o
- `situacao`: Situa√ß√£o funcional (ex: Nomea√ß√£o)
- `data_admissao`: Data de admiss√£o na empresa
- `data_nascimento`: Data de nascimento
- `rg`: Registro Geral
- `cpf`: CPF do usu√°rio
- `avatar_url`: URL do avatar
- `access_type`: Tipo de acesso (admin, attendant)
- `migrado_supabase`: Flag indicando migra√ß√£o
- `supabase_id`: ID original no Supabase

#### Tabela `avaliacoes`
- `supabase_attendant_id`: ID original do atendente no Supabase
- `migrado_supabase`: Flag indicando migra√ß√£o

## üõ°Ô∏è Seguran√ßa e Controle de Acesso

### Autentica√ß√£o
- Login obrigat√≥rio para acesso ao sistema
- Senhas criptografadas com bcrypt
- Sess√µes com tempo de expira√ß√£o
- Logout autom√°tico por inatividade

### Autoriza√ß√£o
- Middleware de verifica√ß√£o de permiss√µes
- Controle de acesso baseado em roles
- Valida√ß√£o de permiss√µes em cada endpoint
- Logs de auditoria para a√ß√µes sens√≠veis

### Prote√ß√£o de Dados
- Valida√ß√£o de entrada com Zod
- Sanitiza√ß√£o de dados
- Prote√ß√£o contra SQL Injection
- Rate limiting em APIs p√∫blicas

## üìä Matriz de Responsabilidades

| Funcionalidade | Admin | Supervisor | Consultor | Atendente |
|---|---|---|---|---|
| **Gest√£o de Usu√°rios** |
| Criar usu√°rios | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Editar usu√°rios | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Excluir usu√°rios | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **Gest√£o de Atendentes** |
| Criar atendentes | ‚úÖ | ‚úÖ* | ‚ùå | ‚ùå |
| Editar atendentes | ‚úÖ | ‚úÖ* | ‚ùå | ‚ùå |
| Excluir atendentes | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Visualizar atendentes | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| **Avalia√ß√µes** |
| Visualizar avalia√ß√µes | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| Editar avalia√ß√µes | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Excluir avalia√ß√µes | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Ser avaliado | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| **Relat√≥rios** |
| Relat√≥rios completos | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Relat√≥rios departamentais | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Relat√≥rios b√°sicos | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Relat√≥rios comparativos | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **Gamifica√ß√£o** |
| Rankings de atendentes | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| Sistema de pontua√ß√£o | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| Dashboards competitivos | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| M√©tricas de performance | ‚úÖ | ‚úÖ* | ‚úÖ | ‚ùå |
| Configurar gamifica√ß√£o | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **Sistema** |
| Configura√ß√µes | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Logs de auditoria | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Backup/Restore | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |

*Limitado aos atendentes de sua supervis√£o

## üîß Implementa√ß√£o T√©cnica

### Middleware de Autoriza√ß√£o
```typescript
// middleware.ts
import { withAuth } from 'next-auth/middleware'
import { NextResponse } from 'next/server'

export default withAuth(
  function middleware(request) {
    const { pathname } = request.nextUrl
    const token = request.nextauth.token

    // Verificar acesso a gest√£o de usu√°rios
    if (pathname.startsWith('/usuarios')) {
      if (token?.tipo !== 'admin') {
        return NextResponse.redirect(new URL('/dashboard', request.url))
      }
    }

    // Verificar acesso a gest√£o de atendentes
    if (pathname.startsWith('/atendentes')) {
      if (!['admin', 'supervisor'].includes(token?.tipo)) {
        return NextResponse.redirect(new URL('/dashboard', request.url))
      }
    }

    return NextResponse.next()
  }
)
```

### Hook de Permiss√µes
```typescript
// hooks/use-permissions.ts
import { useSession } from 'next-auth/react'

export function usePermissions() {
  const { data: session } = useSession()
  const userType = session?.user?.tipo

  return {
    canManageUsers: userType === 'admin',
    canManageAttendants: ['admin', 'supervisor'].includes(userType),
    canViewAllEvaluations: userType === 'admin',
    canViewDepartmentEvaluations: ['admin', 'supervisor'].includes(userType),
    canViewBasicReports: ['admin', 'supervisor', 'consultor'].includes(userType),
    canConfigureSystem: userType === 'admin'
  }
}
```

### Valida√ß√£o de Permiss√µes em API
```typescript
// lib/auth-utils.ts
import { getServerSession } from 'next-auth'

export async function requirePermission(requiredTypes: string[]) {
  const session = await getServerSession()
  
  if (!session) {
    throw new Error('N√£o autorizado')
  }
  
  if (!requiredTypes.includes(session.user.tipo)) {
    throw new Error('Acesso negado')
  }
  
  return session
}
```

## üìà Evolu√ß√£o e Manuten√ß√£o

### Roadmap de Permiss√µes

**Vers√£o 1.1**:
- Permiss√µes granulares por departamento
- Delega√ß√£o de permiss√µes tempor√°rias
- Auditoria detalhada de a√ß√µes

**Vers√£o 1.2**:
- Grupos de usu√°rios personalizados
- Permiss√µes baseadas em projetos
- Integra√ß√£o com Active Directory

**Vers√£o 2.0**:
- Sistema de aprova√ß√£o de a√ß√µes
- Permiss√µes condicionais
- API de permiss√µes para integra√ß√µes

### Roadmap de Gamifica√ß√£o

**Q1 2025**: 
- Implementa√ß√£o do sistema b√°sico de pontua√ß√£o
- Cria√ß√£o de conquistas fundamentais
- Dashboard inicial do consultor

**Q2 2025**: 
- Sistema de n√≠veis e progress√£o
- Rankings avan√ßados por m√∫ltiplas m√©tricas
- Relat√≥rios comparativos detalhados

**Q3 2025**: 
- Conquistas din√¢micas e sazonais
- Sistema de desafios e metas
- Integra√ß√£o com notifica√ß√µes em tempo real

**Q4 2025**: 
- IA para recomenda√ß√µes personalizadas
- An√°lise preditiva de performance
- Sistema de mentoria baseado em dados

### Manuten√ß√£o

- **Revis√£o semanal** das m√©tricas de gamifica√ß√£o
- **Revis√£o mensal** das permiss√µes ativas e algoritmos de pontua√ß√£o
- **Auditoria trimestral** dos acessos e introdu√ß√£o de novas conquistas
- **Atualiza√ß√£o semestral** da documenta√ß√£o
- **Treinamento anual** para novos usu√°rios e reformula√ß√£o do sistema

### Monitoramento de Gamifica√ß√£o

- **Logs Operacionais**: A√ß√µes de usu√°rios e uso de funcionalidades de gamifica√ß√£o
- **M√©tricas de Engajamento**: Frequ√™ncia de acesso e tempo em dashboards
- **An√°lise de Performance**: Correla√ß√£o entre gamifica√ß√£o e melhoria de performance
- **Compliance**: Auditoria de altera√ß√µes e verifica√ß√£o de integridade dos dados

## üö® Considera√ß√µes de Seguran√ßa

### Princ√≠pios de Seguran√ßa

1. **Princ√≠pio do Menor Privil√©gio**: Usu√°rios recebem apenas as permiss√µes m√≠nimas necess√°rias
2. **Separa√ß√£o de Responsabilidades**: Fun√ß√µes cr√≠ticas requerem m√∫ltiplas aprova√ß√µes
3. **Defesa em Profundidade**: M√∫ltiplas camadas de seguran√ßa
4. **Auditoria Cont√≠nua**: Todas as a√ß√µes s√£o registradas e monitoradas

### Medidas de Prote√ß√£o

- **Autentica√ß√£o Multifator** (planejada para v1.1)
- **Rota√ß√£o de Senhas** obrigat√≥ria a cada 90 dias
- **Bloqueio de Conta** ap√≥s tentativas de login falhadas
- **Monitoramento de Atividades** suspeitas
- **Backup Seguro** dos dados de permiss√µes

### Compliance

- **LGPD**: Controle de acesso a dados pessoais
- **ISO 27001**: Gest√£o de seguran√ßa da informa√ß√£o
- **SOX**: Controles internos para dados financeiros

---

**Documento atualizado em**: Janeiro 2025  
**Vers√£o**: 2.0  
**Respons√°vel**: Equipe de Desenvolvimento Koerner 360  
**Pr√≥xima revis√£o**: Abril 2025